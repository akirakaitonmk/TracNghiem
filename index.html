<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz App - Auto Scaling</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            startup: { pageReady: () => { return MathJax.startup.defaultPageReady(); } }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @keyframes sceneIn { from { opacity: 0; transform: scale(0.9) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes sceneOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(1.05); } }
        
        .animate-in { animation: sceneIn 0.4s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .animate-out { animation: sceneOut 0.3s forwards ease-in; }

        body {
            background-color: #FFFDD0;
            margin: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            background: white;
            border: 0.4em solid black;
            box-shadow: 0.8em 0.8em 0px 0px rgba(0,0,0,1);
            width: 90vw;
            max-width: 600px;
            max-height: 90vh;
            position: relative;
        }

        .scroll-area {
            flex: 1;
            overflow-y: auto;
            padding: 1em;
            scrollbar-width: none;
        }
        .scroll-area::-webkit-scrollbar { display: none; }

        .neo-btn {
            border: 0.2em solid black;
            box-shadow: 0.3em 0.3em 0px 0px black;
            padding: 0.8em;
            margin-bottom: 0.8em;
            font-weight: 800;
            transition: all 0.1s;
            background: white;
            text-align: left;
        }
        .neo-btn:active {
            transform: translate(0.2em, 0.2em);
            box-shadow: 0px 0px 0px 0px black;
        }
        
        .status-box {
            border-top: 0.3em solid black;
            padding: 1em;
            font-weight: 900;
            text-align: center;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="flex justify-between items-center p-4 border-b-[0.3em] border-black shrink-0">
            <span id="title" class="font-black italic uppercase truncate text-[1.2em]">Quiz</span>
            <div class="bg-yellow-400 border-[0.2em] border-black px-[0.6em] py-[0.2em] font-black text-[0.8em]">
                CÒN: <span id="queue-count">0</span>
            </div>
        </div>

        <div id="quiz-body" class="flex-grow flex flex-col overflow-hidden animate-in">
            <div class="scroll-area">
                <div id="level" class="inline-block bg-black text-white px-2 py-1 text-[0.6em] font-bold mb-4 uppercase"></div>
                <div id="content" class="text-[1.3em] font-black leading-tight mb-6"></div>
                <div id="options" class="flex flex-col"></div>
            </div>
        </div>

        <div id="status" class="status-box hidden shrink-0"></div>
    </div>

    <script>
        let queue = [];
        let current = null;
        let busy = false;

        function reScale() {
            const container = document.getElementById('game-container');
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            let baseSize = Math.min(width / 35, height / 50);
            if (baseSize < 12) baseSize = 12;
            if (baseSize > 20) baseSize = 20;
            
            container.style.fontSize = baseSize + 'px';
        }
        window.addEventListener('resize', reScale);
        reScale();

        const dom = {
            body: document.getElementById('quiz-body'),
            title: document.getElementById('title'),
            level: document.getElementById('level'),
            content: document.getElementById('content'),
            options: document.getElementById('options'),
            queue: document.getElementById('queue-count'),
            status: document.getElementById('status')
        };

        fetch('data.json').then(r => r.json()).then(data => {
            dom.title.innerText = data.ten_de_thi;
            queue = [...data.danh_sach_cau_hoi].sort(() => Math.random() - 0.5);
            next();
        });

        async function next() {
            if (queue.length === 0) {
                dom.body.innerHTML = "<div class='m-auto text-center font-black text-[2em]'>KẾT THÚC!</div>";
                dom.status.classList.add('hidden');
                return;
            }

            busy = true;
            dom.body.classList.replace('animate-in', 'animate-out');

            setTimeout(async () => {
                current = queue.shift();
                dom.queue.innerText = queue.length;
                dom.status.classList.add('hidden');
                dom.options.innerHTML = '';
                
                dom.level.innerText = current.muc_do;
                dom.content.innerHTML = marked.parse(current.noi_dung);

                current.loai === 1 ? renderType1() : renderType2();

                if (window.MathJax && MathJax.typesetPromise) {
                    await MathJax.typesetPromise([dom.body]);
                }
                
                dom.body.classList.replace('animate-out', 'animate-in');
                busy = false;
            }, 300);
        }

        function renderType1() {
            [...current.phuong_an].sort(() => Math.random() - 0.5).forEach(opt => {
                const b = document.createElement('button');
                b.className = "neo-btn";
                b.innerHTML = opt;
                b.onclick = () => !busy && check1(opt, b);
                dom.options.appendChild(b);
            });
        }

        function check1(val, btn) {
            busy = true;
            if (val === current.dap_an_dung) {
                btn.style.background = "#22c55e"; btn.style.color = "white";
                setTimeout(next, 600);
            } else {
                btn.style.background = "#ef4444"; btn.style.color = "white";
                showFeedback(`SAI! ĐÁP ÁN: ${current.dap_an_dung}`, false);
            }
        }

        function renderType2() {
            let items = [...current.phuong_an].sort(() => Math.random() - 0.5);
            items.forEach((item, i) => {
                const d = document.createElement('div');
                d.className = "p-3 border-[0.15em] border-black mb-3 bg-zinc-50 flex flex-col gap-2";
                d.innerHTML = `<div class="font-bold text-[0.9em]">MĐ ${i+1}: ${item.menh_de}</div>`;
                
                const g = document.createElement('div');
                g.className = "flex gap-2";
                ["Đúng", "Sai"].forEach(lbl => {
                    const b = document.createElement('button');
                    b.className = `btn-${i} flex-1 py-1 border-[0.15em] border-black font-black uppercase text-[0.7em] bg-white transition-all`;
                    b.innerText = lbl;
                    b.onclick = () => {
                        document.querySelectorAll(`.btn-${i}`).forEach(el => el.classList.remove('bg-indigo-600', 'text-white'));
                        b.classList.add('bg-indigo-600', 'text-white');
                        item.user = (lbl === "Đúng");
                    };
                    g.appendChild(b);
                });
                d.appendChild(g);
                dom.options.appendChild(d);
            });

            const submit = document.createElement('button');
            submit.className = "neo-btn bg-black text-white text-center w-full mt-2";
            submit.innerText = "XÁC NHẬN";
            submit.onclick = () => {
                const ok = items.every(x => x.user === x.tra_loi);
                if (ok) {
                    showFeedback("CHÍNH XÁC!", true);
                    setTimeout(next, 800);
                } else {
                    let ansTxt = items.map((x, idx) => `MĐ${idx+1}:${x.tra_loi ? 'Đ' : 'S'}`).join(' | ');
                    showFeedback(`SAI! ${ansTxt}`, false);
                }
            };
            dom.options.appendChild(submit);
        }

        function showFeedback(msg, isOk) {
            dom.status.innerText = msg;
            dom.status.className = `status-box block ${isOk ? 'bg-green-400' : 'bg-red-500 text-white'}`;
            dom.status.classList.remove('hidden');
            if (!isOk) {
                queue.push(current);
                queue.sort(() => Math.random() - 0.5);
                setTimeout(next, 3500);
            }
        }
    </script>
</body>
</html>